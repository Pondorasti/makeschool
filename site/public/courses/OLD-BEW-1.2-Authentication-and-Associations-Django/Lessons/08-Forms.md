# üìú Day 8: Working with Forms

### ‚è± Agenda

1. [[**05m**] üèÜ Objectives](#05m-%f0%9f%8f%86-objectives)
2. [[**05m**] ‚òÄÔ∏è Warm Up](#05m-%e2%98%80%ef%b8%8f-warm-up)
3. [[**40m**] üìñ Overview: Working with Forms](#40m-%f0%9f%93%96-overview-working-with-forms)
4. [[**15m**] ‚úì Review: v2 Solution](#15m-%e2%9c%93-review-v2-solution)
5. [[**10m**] üå¥ BREAK](#10m-%f0%9f%8c%b4-break)
6. [[**30m**] üíª Activity: Forms Challenges](#30m-%f0%9f%92%bb-activity-forms-challenges)
7. [üåÉ After Class](#%f0%9f%8c%83-after-class)
8. [üìö Resources & Credits](#%f0%9f%93%9a-resources--credits)

## [**05m**] üèÜ Objectives

1. Recall HTML form concepts introduced in BEW 1.1.
2. Identify and describe different techniques to handle forms in Django.
3. Compose and apply Django forms, alongside class-based views, to create a new Page in the makewiki project.

## [**05m**] ‚òÄÔ∏è Warm Up

Think back to what you learned in BEW 1.1.

In your own words, write down everything you know about the following questions:

**What is a form? How do they work?**

## [**40m**] üìñ Overview: Working with Forms

### Warm Up Review: HTML Forms

In HTML, **a form is a collection of elements inside `<form>...</form>` tags** that allow a visitor to do things like enter text, select options, manipulate objects or controls, and so on, and then **send that information back to the server**.

A form must specify **two things**:

- **WHERE**: The URL to which the data corresponding to the user‚Äôs input should be returned
- **HOW**: The HTTP method the form will use to send the data to the server (`GET` or `POST`)

**EXAMPLE**: Django‚Äôs login form is returned using the `POST` method, in which the browser bundles up the form data, encodes it for transmission, sends it to the server, and then receives back its response.

### GET & POST: The Rules

- `GET` and `POST` are the only methods you can use with HTML forms.
- Typically **used for different purposes**:
    - Use **`POST` when you're going to change the state of the system**
        - **EXAMPLE**: Any request that saves data to a database
    - `GET` should be used only for requests that **do not affect the state of the system**
        - **EXAMPLE**: Searching or filtering

### Django <3's Forms

Django can **simplify and automate** vast portions of this work, and **can also do it more securely** than most programmers would be able to do in code they wrote themselves.

Django handles **three distinct parts** of the work involved in forms:

- **Preparing and restructuring data** to make it ready for rendering
- **Creating HTML forms** for the data
- **Receiving and processing submitted forms** and data from the client

**NOTE**: *It is possible to write code that does all of this manually, but Django can take care of it all for you!*

#### The Form Class

Everything starts with [Django's `Form` class](https://docs.djangoproject.com/en/2.2/ref/forms/api/#django.forms.Form).

A form class's fields directly map to different HTML `<input>` elements. Think back to what you've seen in the MakeWiki admin interface --- that's a good example of what the `Form` class can do without much effort!

#### Sample Code

Forms belong in your app's `forms.py`. You will have to create it if it doesn't exist yet!

```python
from django import forms

class FriendlyForm(forms.Form):
    first_name = forms.CharField(max_length=100)
    last_name = forms.CharField(max_length=100)
```

- **Line 1**: To use the Form class, we need to import the forms module from Django.
- **Line 2**: We create our `FriendlyForm` class, which inherits from Django‚Äôs forms.Form class.

What happens when we use a Django form? Try this in `python manage.py shell`:

```python
>>> from app.form import FriendlyForm
>>> form = FriendlyForm()
>>> print(form.as_p())
```

This will be rendered in your template when you pass the form from your view! Simply surround the output with an HTML form:

```html
<form method="POST">
  {% csrf_token %}
  {{ form.as_p }}
  <input type="submit" value="Send the names to the server!">
</form>
```

### Cross Site Request Forgery Token (csrf_token)

What the heck is that `{% csrf_token %}` thing we keep seeing in forms?

A CSRF token is a unique, secret, unpredictable value that is generated by the server-side application --- in this case, Django.

Think of it like a secret code that only you and a friend know that keeps your notes safe when you're passing them in class. Not that you'd ever do that! ;)

### Using Forms in Class-Based Views

#### FormView vs. CreateView

Use `FormView` when you need a form on the page and want to perform certain action when a valid form is submitted. eg: Having a contact us form and sending an email on form submission.

##### Example

```python
class ContactView(FormView):
    form_class = ContactForm
    template_name = 'contact-us.html'
    success_url = reverse_lazy('contact-us')

    def form_valid(self, form):
        self.send_mail(form.cleaned_data)
        return super(ContactView, self).form_valid(form)

    def send_mail(self, valid_data):
        # Send mail logic
        print(valid_data)
        pass
```

Use `CreateView` when you want to insert a model instance in database on form submission.

```python
# books/models.py
class Book(models.Model):
    title = models.CharField(max_length=100)
    isbn = models.CharField(max_length=100, unique=True)
    is_published = models.BooleanField(default=True)

    def __str__(self):
        return self.title
```

The `Meta` class allows us to specify details about the form, like what fields we want to show to the visitor, or what model we want to use to generate the HTML form:

```python
# books/forms.py
class BookCreateForm(forms.ModelForm):
    class Meta:
        model = Book
        fields = ['title', 'isbn', 'is_published']

```

Finally, use `CreateView` to handle the `GET` and `POST` for the form.

```python
# books/views.py
class BookCreateView(CreateView):
  def get(self, request):
      context = {'form': BookCreateForm()}
      return render(request, 'books/new.html', context)

  def post(self, request):
      form = BookCreateForm(request.POST)
      if form.is_valid():
          book = form.save()
          return HttpResponseRedirect(reverse_lazy('books:detail', args=[book.id]))
      return render(request, 'books/new.html', {'form': form})
```

## [**10m**] üå¥ BREAK

## [**30m**] üíª Activity: Introduce MakeWiki

Watch as your instructor introduces the [MakeWiki](Projects/05-makewiki) project and its requirements!


## üåÉ Wrap-Up

Be sure to complete today's challenges in your `v2` makewiki repo!

The instructors and TAs will be checking in on your progress this week.

Fill out the [Vibe Check](https://make.sc/bew1.2-vibe-check) form to let your instructor know of any thoughts or feelings you'd like to share about the class!

## üìö Resources & Credits

- [**Django Docs**: Working with Forms](https://docs.djangoproject.com/en/2.2/topics/forms/)
- [**Django Girls**: Forms](https://tutorial.djangogirls.org/en/django_forms/)
- [When and How to Use Django FormView](https://www.agiliq.com/blog/2019/01/django-formview/)
- [When and How to Use Django CreateView](https://www.agiliq.com/blog/2019/01/django-createview/)
